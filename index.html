<!--2023.01.30 Hannim-->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta property="og:title" content="QuoteMaker">
    <meta property="og:description" content="ë”°ì˜´í‘œë¥¼ ì°ê¸°ê°€ ê·€ì°®ì•„">
    <meta property="og:image" content="https://raw.githubusercontent.com/jeanguyomarch/pikalogy/master/images/pika_01.png">
    <title>QuoteMaker</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/lodash.js/4.17.21/lodash.min.js" integrity="sha512-WFN04846sdKMIP5LKNphMaWzU7YpMyCU245etK3g/2ARYbPK9Ub18eG+ljU96qKRCWh+quCY7yefSmlkQw1ANQ==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <style>
        h1,p{
            display: inline;
        }
    </style>
</head>
<body>
    <canvas id="canvas" width="500" height="100"></canvas>
    <div>
        <h1>INPUT</h1>
        <p id="pblock"><!--<label for="pblock">êµ¬ë¶„ì ì„ íƒ ğŸ‘‰ </label>-->
                <input type="radio" id="enter" name="group" value="ì—”í„°" checked> <label for="enter">ì—”í„°</label>
                <input type="radio" id="comma" name="group" value="ì½¤ë§ˆ"> <label for="comma">ì½¤ë§ˆ</label>
                <button>ë¦¬ì…‹</button>
                <label id="lblPika"></label>
        </p>
        <br><br>
        <textarea name="taOrigin" id="taOrigin" cols="50" rows="10"></textarea>
    </div>
    <br>
    <div style="float: left;">
        <h1>OUTPUT</h1>
        <p id="pCount"></p>
        <br><br>
        <textarea name="taNew" id="taNew" cols="70" rows="20"></textarea>
    </div>

    <div style="float: right;"></div>
        <h1>CUSTOM</h1>
        <p id="pblock"><!--<label for="pblock">ì„ íƒ ğŸ‘‰ </label>-->
            <input type="radio" id="username" name="group2" value="ë„¤ì„" checked> <label for="username">UserName</label>
            <input type="radio" id="userid" name="group2" value="ì•„ì´ë””"> <label for="userid">UserId</label>
        </p>
        <br><br>
        <textarea name="taCus" id="taCus" cols="70" rows="20"></textarea>
    </div>

</body>
<script type="text/javascript">
    let origin = document.querySelector('#taOrigin'); //INPUT textarea
    let newOutput = document.querySelector('#taNew'); //OUTPUT textarea
    let newCustom = document.querySelector('#taCus'); //CUSTOM textarea
    let radios = document.querySelectorAll('input[type=radio][name="group"]'); //êµ¬ë¶„ì ì„ íƒ ë¼ë””ì˜¤
    let radios2 = document.querySelectorAll('input[type=radio][name="group2"]'); //ì„ íƒ ë¼ë””ì˜¤
    let reset = document.querySelector('#pblock > button'); //ë¦¬ì…‹ë²„íŠ¼
    let outputCount = document.querySelector('#pCount'); //OUTPUT ê°œìˆ˜
    let pikalabel = document.querySelector('#lblPika');

    let test = document.querySelector('#test');

    changePlaceholer(); //í”Œë ˆì´ìŠ¤í™€ë” ì„¸íŒ…

    origin.addEventListener('input', function(){
        changeQuote(origin.value);
    });

    reset.addEventListener('click', function(){
        deleteAll();

        if(pikas){
            //pika.jumpingDecision();
            //pikas = [new Pikachu()];
            _.map(pikas, pika => pika.jumpingDecision());
        }
    });

    _.map(radios, x => 
        x.addEventListener('change', function(){
            changeQuote(origin.value);
        })
    );

    _.map(radios2, x => 
        x.addEventListener('change', function(){
            customQuery(newOutput.value);
        })
    );

    //ì˜ˆì œ ì„¸íŒ…
    function changePlaceholer(){
        if(radios[0].checked){
            origin.placeholder = 'ì—”í„°(New line)ë¥¼ êµ¬ë¶„ìë¡œ ê°’ì„ ë¶„ë¦¬í•©ë‹ˆë‹¤\r\n\nvalue1\r\nvalue2\r\nvalue3\r\n....\r\n...\r\n..\r\n.';
        } else{
            origin.placeholder = 'ì½¤ë§ˆë¥¼ êµ¬ë¶„ìë¡œ ê°’ì„ ë¶„ë¦¬í•©ë‹ˆë‹¤\r\n\nğŸ‘‰ value1, value2, value3...';
        }
    }

    //ì‘ì€ ë”°ì˜´í‘œë‘ ì½¤ë§ˆ ë¶™ì´ê¸°
    function changeQuote(val){
        changePlaceholer();

        if(val){
            let str = _.replace(val, / /g, '');
            let splitter = ',';
            if(document.querySelector('#enter').checked){
                splitter = '\n';
            } else{
                str = _.replace(str, /(?:\r\n|\r|\n)/g, '');
            }

            let split  = _.compact(_.split(str, splitter));
            let newStr = _.map(split, x => '\'' + x + '\'\n');
            
            newOutput.value = _.trimEnd(newStr);//.replace(/\n+$/,''); //ë§ˆì§€ë§‰ ì—”í„°ì œê±°

            outputCount.innerText = 'ğŸ’â€â™€ï¸' + beCool(split.length);
            customQuery(newOutput.value);
        } else{
            deleteAll();
        }
    }

    //ì¿¼ë¦¬ ë§Œë“¤ê¸°
    function customQuery(val){
        if(!val)return;

        let username = document.querySelector('#username');
        let cond = username.checked?'UserName':'UserId';
        let split = _.split(val, '\n');
        let rst = _.map(split, (x, y) => (_.eq(y, 0)?'\t':'') + _.replace(x, ',', '') + '\n\t'); //0ë²ˆì§¸ì—ë§Œ íƒ­ì„ ë„£ê³  ì‹œì‘í•¨
        let query = 
`SELECT
\t*
FROM HBEdu_Passport.dbo.uIv_Statistics_User AS us WITH(NOLOCK)
WHERE ${cond} IN (
${_.trimEnd(rst)}
)`;

        newCustom.value = query;
    }

    //ì…ë ¥ê°’ ë©‹ìˆê²Œ ë°˜í™˜
    function beCool(val) {
        if (val === undefined 
            || val === null 
            || val === '') {
            return val;
        }

        if (typeof val !== 'string') {
            val = val.toString();
        }

        if (val === '10') {
            return 'ğŸ”Ÿ';
        }

        return val
        .replace(/0/g, '0ï¸âƒ£')
        .replace(/1/g, '1ï¸âƒ£')
        .replace(/2/g, '2ï¸âƒ£')
        .replace(/3/g, '3ï¸âƒ£')
        .replace(/4/g, '4ï¸âƒ£')
        .replace(/5/g, '5ï¸âƒ£')
        .replace(/6/g, '6ï¸âƒ£')
        .replace(/7/g, '7ï¸âƒ£')
        .replace(/8/g, '8ï¸âƒ£')
        .replace(/9/g, '9ï¸âƒ£');
  }

    //íœ´ì§€í†µ
    function deleteAll(){
            origin.value = '';
            newOutput.value = '';
            newCustom.value = '';
            outputCount.innerText = '';
    }

    var canvas = document.getElementById('canvas');
    var ctx = canvas.getContext('2d');
    let arrayBuffer;
    const img = new Image();

    var timer = 0; //íƒ€ì´ë¨¸
    
    fetch('https://raw.githubusercontent.com/jeanguyomarch/pikalogy/master/images/pika_01.png')
    .then(response => response.blob())
    .then(blob => blob.arrayBuffer())
    .then(arrayBuffer => {
        const newBlob = new Blob([arrayBuffer], { type: 'image/png' });
        const url = URL.createObjectURL(newBlob);
        img.src = url;
        //console.log(url);
    })
    .catch(error => {
        img.src = 'https://raw.githubusercontent.com/jeanguyomarch/pikalogy/master/images/pika_01.png'; 
    });

    
    class Pikachu{
        constructor(){
            this.x = 0; //í”¼ì¹´ì¸„ xì¢Œí‘œ
            this.y = 60; //í”¼ì¹´ì¸„ yì¢Œí‘œ
            this.width = 30; //í”¼ì¹´ì¸„ ê¸¸ì´
            this.height = 30; //í”¼ì¹´ì¸„ ë†’ì´
            this.speed = 1; //ì†ë„
            this.angle = 0; //íšŒì „ê°
            this.lucky = false; //ëŒì•„ì´
            this.superLucky = false; //ìƒëŒì•„ì´

            this.jumpPoint = 80; //ì í”„í•  ì‹œê°„
            this.jumpTimer = 0; //ì í”„ì¤‘ íƒ€ì´ë¨¸
            this.jumpSwitch = false; //ì í”„í• ì§€ë§ì§€
            this.IsJumping = false; //ì í”„ì¤‘ì¸ì§€

            this.hero = false;
            this.name = 'ì¡°ìƒë‹˜';
        }

        //ê·¸ë ¤ë¼
        draw(){
            img.onload = () => {
                ctx.drawImage(img, this.x - this.width, this.y);
            }

            ctx.font = 'bold 13px ë§‘ì€ê³ ë”•';
            
            if(this.hero){
                //ctx.fillRect(this.x - this.width, this.y, 30, 30);
                ctx.fillText('ë§‰ë‘¥ì´', this.x - this.width + 5, this.y - 3);
            } else{
                if(_.size(this.name) > 0) {
                    ctx.fillText(this.name, this.x - this.width, this.y - 3);
                }
            }
            
            ctx.drawImage(img, this.x - this.width, this.y);
            
        }

        //ëŒì•„ë¼
        rotate(){
            if(this.superLucky){
                this.angle++; //ë¹ ë¥¸íšŒì „
            } else {
                this.angle+= Math.PI / 18; //ëŠë¦°íšŒì „
            }
            
            ctx.save();
            ctx.translate(this.x - this.width, this.y);
            ctx.rotate(this.angle);
            ctx.drawImage(img, -img.width/2, -img.height/2);
            ctx.restore();   

            ctx.font = 'bold 13px ë§‘ì€ê³ ë”•';
            if(this.hero){
                ctx.fillText('ë§‰ë‘¥ì´', this.x - this.width, this.y-20);
            } else{
                if(_.size(this.name) > 0) {
                    ctx.fillText(this.name, this.x - this.width, this.y-20);
                }
            }
        }

        //ê±¸ì–´ë¼
        forward(){
            this.x+=this.speed;
        }

        //ë›°ì–´ë¼
        jumpUp(val){
            this.y-=val;
        }

        //ë‚´ë ¤ì™€ë¼
        jumpDown(val){
            this.y+=val;
        }

        //ì í”„í•  ê²°ì‹¬
        jumpingDecision(){
            if(!this.IsJumping){
                this.jumpSwitch = true;
                this.jumpPoint = _.random(80, 500);
                this.speed = _.random(1, 4);
                this.lucky = _.random(1,10) % 2 == 0;
                this.superLucky = _.random(1, 1000) % 10 == 0;

                pikalabel.innerText = 'âš¡'; //ë°±ë§Œë³¼íŠ¸
                //console.log('âš¡');
            }
        }
    }

    //í”¼ì¹´ì¸„ í´ë¦­
    // canvas.addEventListener('click', function(e){
    //     const x = e.offsetX;
    //     const y = e.offsetY;
    //     const pixel = ctx.getImageData(x, y, 1, 1);
    //     //console.log(pixel.data[3]);
    //     if(pixel.data[3] != 0){
    //         //console.log('image');
    //         pika.jumpingDecision();
    //     }
    // });
    
    const randomHexColor = () => {
                    const red = _.padStart(_.random(0, 255).toString(16), 2, '0');
                    const green = _.padStart(_.random(0, 255).toString(16), 2, '0');
                    const blue = _.padStart(_.random(0, 255).toString(16), 2, '0');
                    return `#${red + green + blue}`;
    };

    //í”¼ì¹´ì¸„ ë“±ì¥
    var pikas = [new Pikachu()]; //new Pikachu();

    //í”¼ì¹´ì¸„ ì¶œë™
    function animate(){
        requestAnimationFrame(animate);
        timer++;
        
        ctx.clearRect(0,0, canvas.width, canvas.height);

        if(_.findLast(pikas).superLucky) {
            let newPika = new Pikachu();
            newPika.hero = true;
            pikas[_.size(pikas) - 1].hero = false;
            newPika.name = '';
            pikas = _.concat(pikas, newPika);
        }
        _.map(pikas, (pika, idx) => {

        
            if(pika.x > canvas.width){
                pikas[idx].x = 0 - pika.width;
            }

            if(timer % pika.jumpPoint == 0){
                // console.log('í”¼ì¹´í”¼ì¹´', timer);
                pika.jumpingDecision();
            }

            if(pika.jumpSwitch){
                if(pika.y >= 10){
                    pika.IsJumping = true;
                    pika.jumpUp(3);
                    pika.jumpTimer++;
                    
                    // console.log('ì í”„ì¤‘',pika.y, jumpTimer);
                }
            }

            if(pika.IsJumping && pika.jumpTimer >= 17 ){
                pika.jumpSwitch = false;
                // console.log('ì í”„ë', pika.y, jumpSwitch);

                if(pika.y < 60){
                    pika.jumpDown(3);
                } else{
                    pika.IsJumping = false;
                    pika.jumpTimer = 0;
                    pikalabel.innerText = '';
                }
            }

            //ì•ìœ¼ë¡œ ê°€ê¸°
            pika.forward();

            //ë’¤ëš±ë’¤ëš± ìŠ¤í…ë°Ÿê¸°
            if(!pika.jumpSwitch && !pika.IsJumping && timer % 10 == 1){
                if(pika.y <= 60){
                    pika.jumpDown(2);
                } else{
                    pika.jumpUp(2);
                }
            }

            //í”¼ì¹´ì¸„ ìš´ ì¢‹ì„ ë•Œë§Œ ëŒë©´ì„œ ì í”„í•¨
            if(!pika.IsJumping || !pika.lucky){
                pika.draw();
            } else{
                pika.rotate();
            }

        });
    }

    animate();
</script>
</html>